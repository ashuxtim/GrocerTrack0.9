{"version":3,"file":"static/js/145.c09f590c.chunk.js","mappings":"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","sources":["pages/CustomerDetailPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { toast } from 'react-toastify';\r\n\r\nimport {\r\n  TextField, Button, Select, MenuItem, FormControl, InputLabel, Box,\r\n  Grid, Card, CardContent, Typography, List, ListItem, ListItemText,\r\n  ListItemButton, IconButton, Pagination,\r\n  Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle\r\n} from '@mui/material';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\n\r\nconst PAGE_SIZE = 10;\r\n\r\nfunction CustomerPage() {\r\n    const [customers, setCustomers] = useState([]); // For the paginated list\r\n    const [allCustomersForDropdown, setAllCustomersForDropdown] = useState([]); // For the dropdown\r\n    const [name, setName] = useState('');\r\n    const [mobile, setMobile] = useState('');\r\n    const [paymentCustomer, setPaymentCustomer] = useState('');\r\n    const [paymentAmount, setPaymentAmount] = useState('');\r\n    const [page, setPage] = useState(1);\r\n    const [count, setCount] = useState(0);\r\n    const [dialogOpen, setDialogOpen] = useState(false);\r\n    const [itemToDelete, setItemToDelete] = useState(null);\r\n\r\n    const fetchPaginatedCustomers = (currentPage) => {\r\n        axios.get(`http://localhost:8000/api/customers/?page=${currentPage}`)\r\n            .then(response => {\r\n                setCustomers(response.data.results);\r\n                setCount(response.data.count);\r\n            });\r\n    };\r\n    \r\n    // --- NEW function to fetch all customers for dropdowns ---\r\n    const fetchAllCustomers = () => {\r\n        axios.get('http://localhost:8000/api/customers/all/')\r\n            .then(res => {\r\n                setAllCustomersForDropdown(res.data); // This now receives a simple array\r\n            });\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchPaginatedCustomers(page);\r\n    }, [page]);\r\n\r\n    useEffect(() => {\r\n        // Fetch all customers once when the component mounts\r\n        fetchAllCustomers();\r\n    }, []);\r\n\r\n\r\n    const handleOpenDialog = (id, name) => {\r\n        setItemToDelete({ id, name });\r\n        setDialogOpen(true);\r\n    };\r\n    const handleCloseDialog = () => {\r\n        setDialogOpen(false);\r\n        setItemToDelete(null);\r\n    };\r\n    const handleConfirmDelete = () => {\r\n        if (!itemToDelete) return;\r\n        axios.delete(`http://localhost:8000/api/customers/${itemToDelete.id}/`)\r\n            .then(() => {\r\n                toast.success('Customer deleted successfully!');\r\n                fetchPaginatedCustomers(page);\r\n                fetchAllCustomers(); // Refresh dropdown list too\r\n            })\r\n            .catch(error => {\r\n                console.error('Error deleting customer:', error);\r\n                toast.error('Failed to delete customer.');\r\n            }).finally(() => {\r\n                handleCloseDialog();\r\n            });\r\n    };\r\n\r\n    const handleAddCustomer = (event) => {\r\n        event.preventDefault();\r\n        axios.post('http://localhost:8000/api/customers/', { name, mobile })\r\n            .then(() => {\r\n                toast.success('Customer added successfully!');\r\n                setName(''); setMobile('');\r\n                fetchPaginatedCustomers(page);\r\n                fetchAllCustomers(); // Refresh dropdown list too\r\n            });\r\n    };\r\n    const handleAddPayment = (event) => {\r\n        event.preventDefault();\r\n        if (!paymentCustomer || !paymentAmount) {\r\n            toast.warn('Please select a customer and enter an amount.');\r\n            return;\r\n        }\r\n        axios.post('http://localhost:8000/api/payments/', { customer: paymentCustomer, amount: paymentAmount })\r\n            .then(() => {\r\n                toast.success('Payment recorded successfully!');\r\n                setPaymentCustomer('');\r\n                setPaymentAmount('');\r\n            });\r\n    };\r\n    const handlePageChange = (event, value) => {\r\n        setPage(value);\r\n    };\r\n\r\n\r\n    return (\r\n        <Box>\r\n            <Typography variant=\"h2\" gutterBottom>ðŸ‘¥ Customers</Typography>\r\n            <Grid container spacing={3}>\r\n                 <Grid item xs={12} md={6}><Card><CardContent>\r\n                    <Typography variant=\"h3\" gutterBottom>Add New Customer</Typography>\r\n                    <Box component=\"form\" onSubmit={handleAddCustomer} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                        <TextField label=\"Full Name\" variant=\"outlined\" value={name} onChange={e => setName(e.target.value)} required />\r\n                        <TextField label=\"Mobile Number\" variant=\"outlined\" value={mobile} onChange={e => setMobile(e.target.value)} />\r\n                        <Button type=\"submit\" variant=\"contained\">Add Customer</Button>\r\n                    </Box>\r\n                </CardContent></Card></Grid>\r\n                <Grid item xs={12} md={6}><Card><CardContent>\r\n                    <Typography variant=\"h3\" gutterBottom>Record Payment</Typography>\r\n                     <Box component=\"form\" onSubmit={handleAddPayment} sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                        <FormControl fullWidth>\r\n                            <InputLabel>Select Customer</InputLabel>\r\n                            {/* --- THIS DROPDOWN NOW USES THE UNPAGINATED LIST --- */}\r\n                            <Select value={paymentCustomer} label=\"Select Customer\" onChange={e => setPaymentCustomer(e.target.value)} required>\r\n                                {allCustomersForDropdown.map(c => <MenuItem key={c.id} value={c.id}>{c.name}</MenuItem>)}\r\n                            </Select>\r\n                        </FormControl>\r\n                        <TextField label=\"Amount Paid\" variant=\"outlined\" type=\"number\" value={paymentAmount} onChange={e => setPaymentAmount(e.target.value)} required />\r\n                        <Button type=\"submit\" variant=\"contained\">Record Payment</Button>\r\n                    </Box>\r\n                </CardContent></Card></Grid>\r\n                <Grid item xs={12}>\r\n                    <Card>\r\n                        <CardContent>\r\n                            <Typography variant=\"h3\" gutterBottom>All Customers</Typography>\r\n                            <List>\r\n                                {customers.map(customer => (\r\n                                    <ListItem key={customer.id}\r\n                                        secondaryAction={\r\n                                            <IconButton edge=\"end\" onClick={() => handleOpenDialog(customer.id, customer.name)}>\r\n                                                <DeleteIcon color=\"error\" />\r\n                                            </IconButton>\r\n                                        }\r\n                                        disablePadding\r\n                                    >\r\n                                        <ListItemButton component={Link} to={`/customer/${customer.id}`}>\r\n                                            <ListItemText primary={customer.name} />\r\n                                        </ListItemButton>\r\n                                    </ListItem>\r\n                                ))}\r\n                            </List>\r\n                        </CardContent>\r\n                        <Box sx={{ display: 'flex', justifyContent: 'center', p: 2 }}>\r\n                            <Pagination count={Math.ceil(count / PAGE_SIZE)} page={page} onChange={handlePageChange} color=\"primary\"/>\r\n                        </Box>\r\n                    </Card>\r\n                </Grid>\r\n            </Grid>\r\n            <Dialog open={dialogOpen} onClose={handleCloseDialog}>\r\n                <DialogTitle>Confirm Deletion</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Are you sure you want to delete customer \"{itemToDelete?.name}\"? This will also delete their entire sales and payment history.\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={handleCloseDialog}>Cancel</Button>\r\n                    <Button onClick={handleConfirmDelete} color=\"error\" autoFocus>Delete</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Box>\r\n    );\r\n}\r\nexport default CustomerPage;"],"names":["customers","setCustomers","useState","allCustomersForDropdown","setAllCustomersForDropdown","name","setName","mobile","setMobile","paymentCustomer","setPaymentCustomer","paymentAmount","setPaymentAmount","page","setPage","count","setCount","dialogOpen","setDialogOpen","itemToDelete","setItemToDelete","fetchPaginatedCustomers","currentPage","axios","get","concat","then","response","data","results","fetchAllCustomers","res","useEffect","handleCloseDialog","_jsxs","Box","children","_jsx","Typography","variant","gutterBottom","Grid","container","spacing","item","xs","md","Card","CardContent","component","onSubmit","event","preventDefault","post","toast","success","sx","display","flexDirection","gap","TextField","label","value","onChange","e","target","required","Button","type","customer","amount","warn","FormControl","fullWidth","InputLabel","Select","map","c","MenuItem","id","List","ListItem","secondaryAction","IconButton","edge","onClick","handleOpenDialog","DeleteIcon","color","disablePadding","ListItemButton","Link","to","ListItemText","primary","justifyContent","p","Pagination","Math","ceil","handlePageChange","Dialog","open","onClose","DialogTitle","DialogContent","DialogContentText","DialogActions","handleConfirmDelete","delete","catch","error","console","finally","autoFocus"],"sourceRoot":""}
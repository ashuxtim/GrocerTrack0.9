{"version":3,"file":"static/js/972.0f58f367.chunk.js","mappings":"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","sources":["pages/AddSalePage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { toast } from 'react-toastify';\r\nimport {\r\n    Box, Grid, Card, CardContent, Typography, TextField, Button,\r\n    FormControl, InputLabel, Select, MenuItem, List, ListItem, ListItemText, Divider,\r\n    Autocomplete // --- NEW IMPORT ---\r\n} from '@mui/material';\r\n\r\nfunction AddSalePage() {\r\n    const [customers, setCustomers] = useState([]);\r\n    const [variants, setVariants] = useState([]);\r\n    // --- MODIFIED STATE: Stores the full customer object, not just the ID ---\r\n    const [selectedCustomer, setSelectedCustomer] = useState(null); \r\n    const [cart, setCart] = useState([]);\r\n    const [selectedVariant, setSelectedVariant] = useState('');\r\n    const [quantity, setQuantity] = useState(1);\r\n    \r\n    useEffect(() => {\r\n        axios.get('http://localhost:8000/api/customers/').then(res => setCustomers(res.data));\r\n        axios.get('http://localhost:8000/api/variants/').then(res => setVariants(res.data));\r\n    }, []);\r\n\r\n    const handleAddToCart = () => {\r\n        const variant = variants.find(v => v.id === parseInt(selectedVariant));\r\n        if (variant && quantity > 0) {\r\n            const cartItem = { \r\n                variant: variant.id, \r\n                variant_name: `${variant.product_name} (${variant.name})`, \r\n                quantity: parseFloat(quantity), \r\n                price_at_sale: variant.price \r\n            };\r\n            setCart([...cart, cartItem]);\r\n            setSelectedVariant('');\r\n            setQuantity(1);\r\n        } else {\r\n            toast.warn('Please select a valid product and quantity.');\r\n        }\r\n    };\r\n\r\n    const handleSubmitSale = () => {\r\n        // --- MODIFIED: Check for selectedCustomer object ---\r\n        if (!selectedCustomer || cart.length === 0) {\r\n            toast.error('Please select a customer and add items to the bill.');\r\n            return;\r\n        }\r\n        const saleData = { \r\n            // --- MODIFIED: Send the ID from the customer object ---\r\n            customer: selectedCustomer.id, \r\n            items: cart.map(({ variant, quantity, price_at_sale }) => ({ variant, quantity, price_at_sale })) \r\n        };\r\n        axios.post('http://localhost:8000/api/sales/', saleData)\r\n            .then(() => {\r\n                toast.success('Sale recorded successfully!');\r\n                setCart([]);\r\n                // --- MODIFIED: Reset state to null ---\r\n                setSelectedCustomer(null);\r\n            })\r\n            .catch(error => {\r\n                console.error('Error recording sale:', error.response.data);\r\n                toast.error('Failed to record sale.');\r\n            });\r\n    };\r\n\r\n    const totalBill = cart.reduce((total, item) => total + (item.quantity * item.price_at_sale), 0);\r\n\r\n    return (\r\n        <Card>\r\n            <CardContent>\r\n                <Typography variant=\"h2\" gutterBottom>üìù Add New Credit Sale</Typography>\r\n                <Grid container spacing={3}>\r\n                    <Grid item xs={12} md={5}>\r\n                        <Typography variant=\"h3\" gutterBottom>1. Add Items to Bill</Typography>\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2}}>\r\n                             {/* --- THIS IS THE NEW AUTOCOMPLETE COMPONENT --- */}\r\n                            <Autocomplete\r\n                                options={customers}\r\n                                getOptionLabel={(option) => option.name}\r\n                                value={selectedCustomer}\r\n                                onChange={(event, newValue) => {\r\n                                    setSelectedCustomer(newValue);\r\n                                }}\r\n                                renderInput={(params) => <TextField {...params} label=\"Search for a Customer\" required />}\r\n                            />\r\n                            <Divider sx={{ my: 1 }}/>\r\n                             <FormControl fullWidth>\r\n                                <InputLabel>Product</InputLabel>\r\n                                <Select value={selectedVariant} label=\"Product\" onChange={e => setSelectedVariant(e.target.value)}>\r\n                                     {variants.map(v => <MenuItem key={v.id} value={v.id}>{v.product_name} ({v.name})</MenuItem>)}\r\n                                </Select>\r\n                            </FormControl>\r\n                            <TextField label=\"Quantity\" type=\"number\" value={quantity} onChange={e => setQuantity(e.target.value)} min=\"0.1\" step=\"0.1\" />\r\n                            <Button variant=\"outlined\" onClick={handleAddToCart}>Add to Bill</Button>\r\n                        </Box>\r\n                    </Grid>\r\n                    <Grid item xs={12} md={7}>\r\n                        <Typography variant=\"h3\" gutterBottom>2. Current Bill</Typography>\r\n                        <List>\r\n                            {cart.map((item, index) => (\r\n                                <ListItem key={index}>\r\n                                    <ListItemText \r\n                                        primary={item.variant_name} \r\n                                        secondary={`Qty: ${item.quantity} @ ‚Çπ${item.price_at_sale}`} \r\n                                    />\r\n                                </ListItem>\r\n                            ))}\r\n                        </List>\r\n                        <Divider />\r\n                        <Typography variant=\"h5\" align=\"right\" sx={{ mt: 2, mr: 2 }}>\r\n                            Total: ‚Çπ{totalBill.toFixed(2)}\r\n                        </Typography>\r\n                        <Button \r\n                            variant=\"contained\" \r\n                            color=\"primary\" \r\n                            fullWidth \r\n                            sx={{ mt: 2 }} \r\n                            onClick={handleSubmitSale}\r\n                            disabled={!selectedCustomer || cart.length === 0}\r\n                        >\r\n                            Submit Sale\r\n                        </Button>\r\n                    </Grid>\r\n                </Grid>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\nexport default AddSalePage;"],"names":["customers","setCustomers","useState","variants","setVariants","selectedCustomer","setSelectedCustomer","cart","setCart","selectedVariant","setSelectedVariant","quantity","setQuantity","useEffect","axios","get","then","res","data","totalBill","reduce","total","item","price_at_sale","_jsx","Card","children","_jsxs","CardContent","Typography","variant","gutterBottom","Grid","container","spacing","xs","md","Box","sx","display","flexDirection","gap","Autocomplete","options","getOptionLabel","option","name","value","onChange","event","newValue","renderInput","params","TextField","_objectSpread","label","required","Divider","my","FormControl","fullWidth","InputLabel","Select","e","target","map","v","MenuItem","id","product_name","type","min","step","Button","onClick","handleAddToCart","find","parseInt","cartItem","variant_name","concat","parseFloat","price","toast","warn","List","index","ListItem","ListItemText","primary","secondary","align","mt","mr","toFixed","color","handleSubmitSale","length","error","saleData","customer","items","_ref","post","success","catch","console","response","disabled"],"sourceRoot":""}